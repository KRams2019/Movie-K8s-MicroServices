package com.mindtree.ratingdataservice.service;

import java.util.List;
import java.util.stream.Collectors;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.PathVariable;

import com.mindtree.ratingdataservice.dto.RatingDto;
import com.mindtree.ratingdataservice.dto.RatingListDto;
import com.mindtree.ratingdataservice.dto.UserRatingDto;
import com.mindtree.ratingdataservice.entity.Rating;
import com.mindtree.ratingdataservice.entity.UserRating;
import com.mindtree.ratingdataservice.repository.RatingRepository;
import com.mindtree.ratingdataservice.repository.UserRatingRepository;

@Service
public class RatingDataService {
	
	ModelMapper modelMapper=new ModelMapper();

	@Autowired
	RatingRepository ratingRepository;
	
	@Autowired
	UserRatingRepository userRatingRepository;
	
	public RatingDto getMovieRating(int movieId) {
		Rating rating= ratingRepository.findById(movieId).get();
		//System.out.println(rating.getRatingId());
		return convertEntityToDto(rating);
	}
	
	public UserRatingDto getUserRatings(int userId) {
		UserRatingDto userDto=new UserRatingDto();
		List<Rating> ratings= userRatingRepository.findById(userId).get().getRatings();
		List<RatingDto> ratingDtoList=ratings.stream().map(entity->convertEntityToDto(entity)).collect(Collectors.toList());
		userDto.setName(userRatingRepository.findById(userId).get().getName());
		userDto.setUserId(userId);
		userDto.setRatings(ratingDtoList);
		return userDto;
	}
	
	public List<RatingDto> getAvgRatings() {
		List<Rating> ratings= ratingRepository.findAll();
		List<RatingDto> ratingDtoList=ratings.stream().map(entity->convertEntityToDto(entity)).collect(Collectors.toList());
		//RatingListDto ratingListDto=new RatingListDto();
		//ratingListDto.setRatingDto(ratingDtoList);
		return ratingDtoList;
		
	}
	
	public UserRating adduserRating(UserRating userRating) {
		//userRating = new UserRating(userId, name, ratings);
		return userRatingRepository.save(userRating);
	}
	
	public Rating addRating(Rating rating) {
		//rating = new Rating(ratingId, movieId, rating, userRating);
		return ratingRepository.save(rating);
	}
	
	public RatingDto convertEntityToDto(Rating rating) {
		return modelMapper.map(rating,RatingDto.class);
	}
	
	
}
